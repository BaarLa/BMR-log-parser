<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Battle Mages Log Parser</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { font-size: 24px; }
        input { margin: 5px 0; }
        textarea { width: 100%; height: 300px; margin-top: 10px; }
        button { margin-top: 10px; padding: 5px 10px; }
        .log-output { white-space: pre-wrap; background: #f0f0f0; padding: 10px; margin-top: 10px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h1>Battle Mages Log Parser</h1>

    <label>First player name: <input type="text" id="player1" value="Calypso"></label><br>
    <label>Second player name: <input type="text" id="player2" value="Elyssa"></label><br>
    <label>Paste HTML content here:</label><br>
    <textarea id="htmlInput"></textarea><br>
    <button id="parseBtn">Parse Logs</button>

    <h2>Parsed Output:</h2>
    <div class="log-output" id="output"></div>

<script>
document.getElementById('parseBtn').addEventListener('click', () => {
    const html = document.getElementById('htmlInput').value;
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');

    const player1 = document.getElementById('player1').value || 'Player1';
    const player2 = document.getElementById('player2').value || 'Player2';
    const players = [player1, player2];

    const logs = [];

    doc.querySelectorAll('#dialog .dialog_box').forEach((dialogBox, idx) => {
        const charName = players[idx % players.length];

        dialogBox.querySelectorAll('.log, .content.format').forEach(div => {
            const timestamp = div.querySelector('.timestamp')?.textContent || '';
            const parts = Array.from(div.childNodes).map(node => {
                if (node.nodeType === Node.TEXT_NODE) {
                    const text = node.textContent.trim();
                    if (!text) return null;
                    return { type: 'IC', text };
                } else if (node.classList) {
                    if (node.classList.contains('ooc')) return { type: 'OOC', text: node.textContent.trim() };
                    if (node.classList.contains('emote')) return { type: 'EMOTE', text: node.textContent.trim() };
                    return { type: 'IC', text: node.textContent.trim() };
                } else {
                    return { type: 'IC', text: node.textContent.trim() };
                }
            }).filter(Boolean);

            parts.forEach(p => logs.push({
                timestamp,
                character: charName,
                type: p.type,
                text: p.text
            }));
        });
    });

    logs.sort((a, b) => {
        if (!a.timestamp) return 1;
        if (!b.timestamp) return -1;
        return a.timestamp.localeCompare(b.timestamp);
    });

    const outputLines = logs.map(log => `${log.character} [${log.type}] ${log.timestamp} ${log.text}`);
    document.getElementById('output').textContent = outputLines.join('\n');
});
</script>
</body>
</html>
